#!/bin/bash
set -e

# 1. Restore the standard S2I build logic
# If this is a wheelhouse build, use the upstream assemble
if [ -d /opt/app-root/wheelhouse ]; then
    if [ -f /usr/libexec/s2i/assemble ]; then
        exec /usr/libexec/s2i/assemble
    else
        exec /opt/app-root/s2i/assemble
    fi
fi

# 2. (Optional) Run your "Action Hooks" manually
# If you used powershift to run pre-build scripts, just run them here directly.
# Example:
# if [ -f ./.s2i/action_hooks/pre_build ]; then
#     ./.s2i/action_hooks/pre_build
# fi

# 3. Execute the Standard Assemble Script
# This runs the actual build (pip install -r requirements.txt, etc.)
echo "---> Running standard S2I assemble..."
if [ -f /usr/libexec/s2i/assemble ]; then
    exec /usr/libexec/s2i/assemble
else
    exec /opt/app-root/s2i/assemble
fi
