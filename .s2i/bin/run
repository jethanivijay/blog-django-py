#!/bin/bash
set -eo pipefail

# 1. WHEELHOUSE CHECK (Keep original logic)
# If this is just a build artifact container, run the default script immediately.
if [ -d /opt/app-root/wheelhouse ]; then
    exec /opt/app-root/s2i/run
fi

# 2. RUN CUSTOM PRE-RUN HOOKS (Native replacement for powershift)
# If you have a script at .s2i/bin/pre-run, execute it.
# This is useful for DB migrations or config generation before the app starts.
if [ -f "${HOME}/.s2i/bin/pre-run" ]; then
    echo "---> Running custom pre-run script..."
    source "${HOME}/.s2i/bin/pre-run"
fi

# 3. START THE APPLICATION
# Transfer control to the official S2I run script.
exec /opt/app-root/s2i/run
